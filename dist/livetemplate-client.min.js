(()=>{var oe=Object.defineProperty;var f=(i,e)=>oe(i,"name",{value:e,configurable:!0});var q=11;function ce(i,e){var t=e.attributes,n,a,o,l,p;if(!(e.nodeType===q||i.nodeType===q)){for(var b=t.length-1;b>=0;b--)n=t[b],a=n.name,o=n.namespaceURI,l=n.value,o?(a=n.localName||a,p=i.getAttributeNS(o,a),p!==l&&(n.prefix==="xmlns"&&(a=n.name),i.setAttributeNS(o,a,l))):(p=i.getAttribute(a),p!==l&&i.setAttribute(a,l));for(var L=i.attributes,N=L.length-1;N>=0;N--)n=L[N],a=n.name,o=n.namespaceURI,o?(a=n.localName||a,e.hasAttributeNS(o,a)||i.removeAttributeNS(o,a)):e.hasAttribute(a)||i.removeAttribute(a)}}f(ce,"morphAttrs");var E,le="http://www.w3.org/1999/xhtml",v=typeof document>"u"?void 0:document,de=!!v&&"content"in v.createElement("template"),fe=!!v&&v.createRange&&"createContextualFragment"in v.createRange();function ue(i){var e=v.createElement("template");return e.innerHTML=i,e.content.childNodes[0]}f(ue,"createFragmentFromTemplate");function he(i){E||(E=v.createRange(),E.selectNode(v.body));var e=E.createContextualFragment(i);return e.childNodes[0]}f(he,"createFragmentFromRange");function ve(i){var e=v.createElement("body");return e.innerHTML=i,e.childNodes[0]}f(ve,"createFragmentFromWrap");function pe(i){return i=i.trim(),de?ue(i):fe?he(i):ve(i)}f(pe,"toElement");function H(i,e){var t=i.nodeName,n=e.nodeName,a,o;return t===n?!0:(a=t.charCodeAt(0),o=n.charCodeAt(0),a<=90&&o>=97?t===n.toUpperCase():o<=90&&a>=97?n===t.toUpperCase():!1)}f(H,"compareNodeNames");function me(i,e){return!e||e===le?v.createElement(i):v.createElementNS(e,i)}f(me,"createElementNS");function ge(i,e){for(var t=i.firstChild;t;){var n=t.nextSibling;e.appendChild(t),t=n}return e}f(ge,"moveChildren");function j(i,e,t){i[t]!==e[t]&&(i[t]=e[t],i[t]?i.setAttribute(t,""):i.removeAttribute(t))}f(j,"syncBooleanAttrProp");var J={OPTION:function(i,e){var t=i.parentNode;if(t){var n=t.nodeName.toUpperCase();n==="OPTGROUP"&&(t=t.parentNode,n=t&&t.nodeName.toUpperCase()),n==="SELECT"&&!t.hasAttribute("multiple")&&(i.hasAttribute("selected")&&!e.selected&&(i.setAttribute("selected","selected"),i.removeAttribute("selected")),t.selectedIndex=-1)}j(i,e,"selected")},INPUT:function(i,e){j(i,e,"checked"),j(i,e,"disabled"),i.value!==e.value&&(i.value=e.value),e.hasAttribute("value")||i.removeAttribute("value")},TEXTAREA:function(i,e){var t=e.value;i.value!==t&&(i.value=t);var n=i.firstChild;if(n){var a=n.nodeValue;if(a==t||!t&&a==i.placeholder)return;n.nodeValue=t}},SELECT:function(i,e){if(!e.hasAttribute("multiple")){for(var t=-1,n=0,a=i.firstChild,o,l;a;)if(l=a.nodeName&&a.nodeName.toUpperCase(),l==="OPTGROUP")o=a,a=o.firstChild,a||(a=o.nextSibling,o=null);else{if(l==="OPTION"){if(a.hasAttribute("selected")){t=n;break}n++}a=a.nextSibling,!a&&o&&(a=o.nextSibling,o=null)}i.selectedIndex=t}}},U=1,Y=11,Q=3,Z=8;function T(){}f(T,"noop");function Ae(i){if(i)return i.getAttribute&&i.getAttribute("id")||i.id}f(Ae,"defaultGetNodeKey");function Te(i){return f(function(t,n,a){if(a||(a={}),typeof n=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var o=n;n=v.createElement("html"),n.innerHTML=o}else n=pe(n);else n.nodeType===Y&&(n=n.firstElementChild);var l=a.getNodeKey||Ae,p=a.onBeforeNodeAdded||T,b=a.onNodeAdded||T,L=a.onBeforeElUpdated||T,N=a.onElUpdated||T,te=a.onBeforeNodeDiscarded||T,C=a.onNodeDiscarded||T,ne=a.onBeforeElChildrenUpdated||T,ae=a.skipFromChildren||T,G=a.addChild||function(r,s){return r.appendChild(s)},P=a.childrenOnly===!0,w=Object.create(null),x=[];function D(r){x.push(r)}f(D,"addKeyedRemoval");function z(r,s){if(r.nodeType===U)for(var u=r.firstChild;u;){var c=void 0;s&&(c=l(u))?D(c):(C(u),u.firstChild&&z(u,s)),u=u.nextSibling}}f(z,"walkDiscardedChildNodes");function k(r,s,u){te(r)!==!1&&(s&&s.removeChild(r),C(r),z(r,u))}f(k,"removeNode");function V(r){if(r.nodeType===U||r.nodeType===Y)for(var s=r.firstChild;s;){var u=l(s);u&&(w[u]=s),V(s),s=s.nextSibling}}f(V,"indexTree"),V(t);function _(r){b(r);for(var s=r.firstChild;s;){var u=s.nextSibling,c=l(s);if(c){var d=w[c];d&&H(s,d)?(s.parentNode.replaceChild(d,s),M(d,s)):_(s)}else _(s);s=u}}f(_,"handleNodeAdded");function ie(r,s,u){for(;s;){var c=s.nextSibling;(u=l(s))?D(u):k(s,r,!0),s=c}}f(ie,"cleanupFromEl");function M(r,s,u){var c=l(s);if(c&&delete w[c],!u){var d=L(r,s);if(d===!1||(d instanceof HTMLElement&&(r=d,V(r)),i(r,s),N(r),ne(r,s)===!1))return}r.nodeName!=="TEXTAREA"?re(r,s):J.TEXTAREA(r,s)}f(M,"morphEl");function re(r,s){var u=ae(r,s),c=s.firstChild,d=r.firstChild,y,m,S,$,g;e:for(;c;){for($=c.nextSibling,y=l(c);!u&&d;){if(S=d.nextSibling,c.isSameNode&&c.isSameNode(d)){c=$,d=S;continue e}m=l(d);var F=d.nodeType,A=void 0;if(F===c.nodeType&&(F===U?(y?y!==m&&((g=w[y])?S===g?A=!1:(r.insertBefore(g,d),m?D(m):k(d,r,!0),d=g,m=l(d)):A=!1):m&&(A=!1),A=A!==!1&&H(d,c),A&&M(d,c)):(F===Q||F==Z)&&(A=!0,d.nodeValue!==c.nodeValue&&(d.nodeValue=c.nodeValue))),A){c=$,d=S;continue e}m?D(m):k(d,r,!0),d=S}if(y&&(g=w[y])&&H(g,c))u||G(r,g),M(g,c);else{var I=p(c);I!==!1&&(I&&(c=I),c.actualize&&(c=c.actualize(r.ownerDocument||v)),G(r,c),_(c))}c=$,d=S}ie(r,d,m);var X=J[r.nodeName];X&&X(r,s)}f(re,"morphChildren");var h=t,R=h.nodeType,K=n.nodeType;if(!P){if(R===U)K===U?H(t,n)||(C(t),h=ge(t,me(n.nodeName,n.namespaceURI))):h=n;else if(R===Q||R===Z){if(K===R)return h.nodeValue!==n.nodeValue&&(h.nodeValue=n.nodeValue),h;h=n}}if(h===n)C(t);else{if(n.isSameNode&&n.isSameNode(h))return;if(M(h,n,P),x)for(var B=0,se=x.length;B<se;B++){var W=w[x[B]];W&&k(W,W.parentNode,!1)}}return!P&&h!==t&&t.parentNode&&(h.actualize&&(h=h.actualize(t.ownerDocument||v)),t.parentNode.replaceChild(h,t)),h},"morphdom")}f(Te,"morphdomFactory");var we=Te(ce),ee=we;var O=class{static{f(this,"LiveTemplateClient")}constructor(e={}){this.wsUrl=e.wsUrl||this.buildWebSocketUrl(),this.pageToken=null,this.ws=null,this.staticCache=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=e.maxReconnectAttempts||5,this.reconnectDelay=e.reconnectDelay||1e3,this.onOpen=e.onOpen||(()=>console.log("\u{1F50C} LiveTemplate connected")),this.onClose=e.onClose||(()=>console.log("\u{1F50C} LiveTemplate disconnected")),this.onError=e.onError||(t=>console.error("\u274C LiveTemplate error:",t)),this.onFragmentUpdate=e.onFragmentUpdate||null}buildWebSocketUrl(){let e=window.location.protocol==="https:"?"wss:":"ws:",t=window.location.host;return`${e}//${t}/ws`}connect(e){if(this.ws&&this.ws.readyState===WebSocket.OPEN){console.log("Already connected");return}this.pageToken=e;let t=`${this.wsUrl}?token=${e}`;console.log("\u{1F50C} Connecting to LiveTemplate:",t),this.ws=new WebSocket(t),this.setupEventHandlers()}setupEventHandlers(){this.ws.onopen=()=>{console.log("\u2705 LiveTemplate WebSocket connection established"),this.reconnectAttempts=0,this.onOpen()},this.ws.onclose=e=>{console.log(`\u{1F50C} LiveTemplate WebSocket closed (code: ${e.code})`),this.onClose(e),e.code!==1e3&&this.attemptReconnect()},this.ws.onerror=e=>{console.error("\u274C LiveTemplate WebSocket error:",e),this.onError(e)},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);console.log("\u{1F4E6} Received fragments:",t),this.applyFragments(t)}catch(t){console.error("\u274C Error parsing fragment data:",t,e.data)}}}applyFragments(e){(Array.isArray(e)?e:Object.entries(e).map(([n,a])=>({id:n,data:a}))).forEach(n=>{try{this.applyDiffUpdate(n)}catch(a){console.error(`\u274C Error applying fragment ${n.id}:`,a)}})}applyDiffUpdate(e){let t=document.querySelector(`[lvt-id="${e.id}"]`);if(!t){console.warn(`\u26A0\uFE0F Element with lvt-id="${e.id}" not found`);return}if(!e.data||typeof e.data!="object"){console.warn(`\u26A0\uFE0F Invalid diff.Update data for fragment ${e.id}`);return}let n=e.data;n.s&&Array.isArray(n.s)&&(this.staticCache.set(e.id,n.s),console.log(`\u{1F4BE} Cached ${n.s.length} static segments for fragment ${e.id}`));let a=this.staticCache.get(e.id)||[],o=this.reconstructFromDiffUpdate(a,n);if(o===null){console.log(`\u23F8\uFE0F Fragment ${e.id}: No content to update`);return}this.applyContentUpdate(t,o,e.id),this.onFragmentUpdate&&this.onFragmentUpdate(e,t)}reconstructFromDiffUpdate(e,t){if(!e.length&&(!t.s||!t.s.length))return console.warn("\u26A0\uFE0F No static segments available for reconstruction"),null;let n=t.s||e;if(!Object.keys(t).some(l=>l!=="s"&&l!=="h"&&l!=="S"&&l!=="H"))return n.join("");let o="";for(let l=0;l<n.length;l++)if(o+=n[l],l<n.length-1){let p=t[l.toString()];p!==void 0&&(o+=p)}return o}applyContentUpdate(e,t,n){let a=e.cloneNode(!1);a.innerHTML=t,console.log(`\u{1F504} Updating fragment ${n}:`,{element:e.tagName+(e.className?"."+e.className:""),oldContent:e.innerHTML.substring(0,50)+(e.innerHTML.length>50?"...":""),newContent:t.substring(0,50)+(t.length>50?"...":"")}),ee(e,a,{onBeforeElUpdated:(o,l)=>(o===document.activeElement,!0),childrenOnly:!0}),console.log(`\u2705 Fragment ${n}: Applied diff update`)}sendAction(e,t={}){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("\u26A0\uFE0F WebSocket not connected, cannot send action");return}let n=Array.from(this.staticCache.keys()),a={action:e,cache:n,...t};console.log("\u{1F4E4} Sending action:",a),console.log(`\u{1F4E6} Cache info: ${n.length} cached fragments: [${n.join(", ")}]`),this.ws.send(JSON.stringify(a))}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error(`\u274C Max reconnection attempts (${this.maxReconnectAttempts}) reached`);return}this.reconnectAttempts++;let e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`\u{1F504} Reconnection attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${e}ms`),setTimeout(()=>{this.pageToken&&this.connect(this.pageToken)},e)}disconnect(){this.ws&&(this.ws.close(1e3,"Client requested disconnect"),this.ws=null),this.staticCache.clear()}};function ye(){if(typeof window>"u"||typeof document>"u")return;function i(){let e=document.querySelector('meta[name="livetemplate-token"]');if(!e){console.warn('\u26A0\uFE0F LiveTemplate: No token found. Add <meta name="livetemplate-token" content="{{.Token}}"> to your template.');return}let t=e.getAttribute("content");if(!t){console.warn("\u26A0\uFE0F LiveTemplate: Empty token found.");return}let n=new O({onOpen:()=>console.log("\u{1F50C} Connected to LiveTemplate"),onError:a=>console.error("\u274C LiveTemplate error:",a)});window.liveTemplateClient=n,n.connect(t),document.addEventListener("click",function(a){let o=a.target.getAttribute("data-lvt-action");o&&(a.preventDefault(),n.sendAction(o))}),console.log("\u2705 LiveTemplate auto-initialized")}f(i,"initLiveTemplate"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()}f(ye,"autoInit");typeof window<"u"&&(window.LiveTemplateClient=O,ye());var Oe=O;})();
