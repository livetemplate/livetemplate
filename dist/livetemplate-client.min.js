(()=>{var oe=Object.defineProperty;var u=(a,e)=>oe(a,"name",{value:e,configurable:!0});var J=11;function ce(a,e){var n=e.attributes,t,i,o,c,p;if(!(e.nodeType===J||a.nodeType===J)){for(var T=n.length-1;T>=0;T--)t=n[T],i=t.name,o=t.namespaceURI,c=t.value,o?(i=t.localName||i,p=a.getAttributeNS(o,i),p!==c&&(t.prefix==="xmlns"&&(i=t.name),a.setAttributeNS(o,i,c))):(p=a.getAttribute(i),p!==c&&a.setAttribute(i,c));for(var L=a.attributes,N=L.length-1;N>=0;N--)t=L[N],i=t.name,o=t.namespaceURI,o?(i=t.localName||i,e.hasAttributeNS(o,i)||a.removeAttributeNS(o,i)):e.hasAttribute(i)||a.removeAttribute(i)}}u(ce,"morphAttrs");var E,le="http://www.w3.org/1999/xhtml",v=typeof document>"u"?void 0:document,de=!!v&&"content"in v.createElement("template"),ue=!!v&&v.createRange&&"createContextualFragment"in v.createRange();function fe(a){var e=v.createElement("template");return e.innerHTML=a,e.content.childNodes[0]}u(fe,"createFragmentFromTemplate");function he(a){E||(E=v.createRange(),E.selectNode(v.body));var e=E.createContextualFragment(a);return e.childNodes[0]}u(he,"createFragmentFromRange");function ve(a){var e=v.createElement("body");return e.innerHTML=a,e.childNodes[0]}u(ve,"createFragmentFromWrap");function pe(a){return a=a.trim(),de?fe(a):ue?he(a):ve(a)}u(pe,"toElement");function H(a,e){var n=a.nodeName,t=e.nodeName,i,o;return n===t?!0:(i=n.charCodeAt(0),o=t.charCodeAt(0),i<=90&&o>=97?n===t.toUpperCase():o<=90&&i>=97?t===n.toUpperCase():!1)}u(H,"compareNodeNames");function ge(a,e){return!e||e===le?v.createElement(a):v.createElementNS(e,a)}u(ge,"createElementNS");function me(a,e){for(var n=a.firstChild;n;){var t=n.nextSibling;e.appendChild(n),n=t}return e}u(me,"moveChildren");function G(a,e,n){a[n]!==e[n]&&(a[n]=e[n],a[n]?a.setAttribute(n,""):a.removeAttribute(n))}u(G,"syncBooleanAttrProp");var I={OPTION:function(a,e){var n=a.parentNode;if(n){var t=n.nodeName.toUpperCase();t==="OPTGROUP"&&(n=n.parentNode,t=n&&n.nodeName.toUpperCase()),t==="SELECT"&&!n.hasAttribute("multiple")&&(a.hasAttribute("selected")&&!e.selected&&(a.setAttribute("selected","selected"),a.removeAttribute("selected")),n.selectedIndex=-1)}G(a,e,"selected")},INPUT:function(a,e){G(a,e,"checked"),G(a,e,"disabled"),a.value!==e.value&&(a.value=e.value),e.hasAttribute("value")||a.removeAttribute("value")},TEXTAREA:function(a,e){var n=e.value;a.value!==n&&(a.value=n);var t=a.firstChild;if(t){var i=t.nodeValue;if(i==n||!n&&i==a.placeholder)return;t.nodeValue=n}},SELECT:function(a,e){if(!e.hasAttribute("multiple")){for(var n=-1,t=0,i=a.firstChild,o,c;i;)if(c=i.nodeName&&i.nodeName.toUpperCase(),c==="OPTGROUP")o=i,i=o.firstChild,i||(i=o.nextSibling,o=null);else{if(c==="OPTION"){if(i.hasAttribute("selected")){n=t;break}t++}i=i.nextSibling,!i&&o&&(i=o.nextSibling,o=null)}a.selectedIndex=n}}},O=1,Y=11,Q=3,Z=8;function A(){}u(A,"noop");function ye(a){if(a)return a.getAttribute&&a.getAttribute("id")||a.id}u(ye,"defaultGetNodeKey");function Ae(a){return u(function(n,t,i){if(i||(i={}),typeof t=="string")if(n.nodeName==="#document"||n.nodeName==="HTML"||n.nodeName==="BODY"){var o=t;t=v.createElement("html"),t.innerHTML=o}else t=pe(t);else t.nodeType===Y&&(t=t.firstElementChild);var c=i.getNodeKey||ye,p=i.onBeforeNodeAdded||A,T=i.onNodeAdded||A,L=i.onBeforeElUpdated||A,N=i.onElUpdated||A,te=i.onBeforeNodeDiscarded||A,$=i.onNodeDiscarded||A,ne=i.onBeforeElChildrenUpdated||A,ie=i.skipFromChildren||A,z=i.addChild||function(r,s){return r.appendChild(s)},P=i.childrenOnly===!0,w=Object.create(null),C=[];function F(r){C.push(r)}u(F,"addKeyedRemoval");function K(r,s){if(r.nodeType===O)for(var f=r.firstChild;f;){var l=void 0;s&&(l=c(f))?F(l):($(f),f.firstChild&&K(f,s)),f=f.nextSibling}}u(K,"walkDiscardedChildNodes");function x(r,s,f){te(r)!==!1&&(s&&s.removeChild(r),$(r),K(r,f))}u(x,"removeNode");function V(r){if(r.nodeType===O||r.nodeType===Y)for(var s=r.firstChild;s;){var f=c(s);f&&(w[f]=s),V(s),s=s.nextSibling}}u(V,"indexTree"),V(n);function B(r){T(r);for(var s=r.firstChild;s;){var f=s.nextSibling,l=c(s);if(l){var d=w[l];d&&H(s,d)?(s.parentNode.replaceChild(d,s),D(d,s)):B(s)}else B(s);s=f}}u(B,"handleNodeAdded");function ae(r,s,f){for(;s;){var l=s.nextSibling;(f=c(s))?F(f):x(s,r,!0),s=l}}u(ae,"cleanupFromEl");function D(r,s,f){var l=c(s);if(l&&delete w[l],!f){var d=L(r,s);if(d===!1||(d instanceof HTMLElement&&(r=d,V(r)),a(r,s),N(r),ne(r,s)===!1))return}r.nodeName!=="TEXTAREA"?re(r,s):I.TEXTAREA(r,s)}u(D,"morphEl");function re(r,s){var f=ie(r,s),l=s.firstChild,d=r.firstChild,b,g,S,R,m;e:for(;l;){for(R=l.nextSibling,b=c(l);!f&&d;){if(S=d.nextSibling,l.isSameNode&&l.isSameNode(d)){l=R,d=S;continue e}g=c(d);var k=d.nodeType,y=void 0;if(k===l.nodeType&&(k===O?(b?b!==g&&((m=w[b])?S===m?y=!1:(r.insertBefore(m,d),g?F(g):x(d,r,!0),d=m,g=c(d)):y=!1):g&&(y=!1),y=y!==!1&&H(d,l),y&&D(d,l)):(k===Q||k==Z)&&(y=!0,d.nodeValue!==l.nodeValue&&(d.nodeValue=l.nodeValue))),y){l=R,d=S;continue e}g?F(g):x(d,r,!0),d=S}if(b&&(m=w[b])&&H(m,l))f||z(r,m),D(m,l);else{var j=p(l);j!==!1&&(j&&(l=j),l.actualize&&(l=l.actualize(r.ownerDocument||v)),z(r,l),B(l))}l=R,d=S}ae(r,d,g);var q=I[r.nodeName];q&&q(r,s)}u(re,"morphChildren");var h=n,M=h.nodeType,X=t.nodeType;if(!P){if(M===O)X===O?H(n,t)||($(n),h=me(n,ge(t.nodeName,t.namespaceURI))):h=t;else if(M===Q||M===Z){if(X===M)return h.nodeValue!==t.nodeValue&&(h.nodeValue=t.nodeValue),h;h=t}}if(h===t)$(n);else{if(t.isSameNode&&t.isSameNode(h))return;if(D(h,t,P),C)for(var _=0,se=C.length;_<se;_++){var W=w[C[_]];W&&x(W,W.parentNode,!1)}}return!P&&h!==n&&n.parentNode&&(h.actualize&&(h=h.actualize(n.ownerDocument||v)),n.parentNode.replaceChild(h,n)),h},"morphdom")}u(Ae,"morphdomFactory");var Te=Ae(ce),ee=Te;var U=class{static{u(this,"LiveTemplateClient")}constructor(e={}){this.wsUrl=e.wsUrl||this.buildWebSocketUrl(),this.pageToken=null,this.ws=null,this.staticCache=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=e.maxReconnectAttempts||5,this.reconnectDelay=e.reconnectDelay||1e3,this.onOpen=e.onOpen||(()=>console.log("\u{1F50C} LiveTemplate connected")),this.onClose=e.onClose||(()=>console.log("\u{1F50C} LiveTemplate disconnected")),this.onError=e.onError||(n=>console.error("\u274C LiveTemplate error:",n)),this.onFragmentUpdate=e.onFragmentUpdate||null}buildWebSocketUrl(){let e=window.location.protocol==="https:"?"wss:":"ws:",n=window.location.host;return`${e}//${n}/ws`}connect(e){if(this.ws&&this.ws.readyState===WebSocket.OPEN){console.log("Already connected");return}this.pageToken=e;let n=`${this.wsUrl}?token=${e}`;console.log("\u{1F50C} Connecting to LiveTemplate:",n),this.ws=new WebSocket(n),this.setupEventHandlers()}setupEventHandlers(){this.ws.onopen=()=>{console.log("\u2705 LiveTemplate WebSocket connection established"),this.reconnectAttempts=0,this.onOpen()},this.ws.onclose=e=>{console.log(`\u{1F50C} LiveTemplate WebSocket closed (code: ${e.code})`),this.onClose(e),e.code!==1e3&&this.attemptReconnect()},this.ws.onerror=e=>{console.error("\u274C LiveTemplate WebSocket error:",e),this.onError(e)},this.ws.onmessage=e=>{try{let n=JSON.parse(e.data);console.log("\u{1F4E6} Received fragments:",n),this.applyFragments(n)}catch(n){console.error("\u274C Error parsing fragment data:",n,e.data)}}}applyFragments(e){(Array.isArray(e)?e:Object.entries(e).map(([t,i])=>({id:t,data:i}))).forEach(t=>{try{this.applyDiffUpdate(t)}catch(i){console.error(`\u274C Error applying fragment ${t.id}:`,i)}})}applyDiffUpdate(e){let n=document.querySelector(`[lvt-id="${e.id}"]`);if(!n){console.warn(`\u26A0\uFE0F Element with lvt-id="${e.id}" not found`);return}if(!e.data||typeof e.data!="object"){console.warn(`\u26A0\uFE0F Invalid diff.Update data for fragment ${e.id}`);return}let t=e.data;t.s&&Array.isArray(t.s)&&(this.staticCache.set(e.id,t.s),console.log(`\u{1F4BE} Cached ${t.s.length} static segments for fragment ${e.id}`));let i=this.staticCache.get(e.id)||[],o=this.reconstructFromDiffUpdate(i,t);if(o===null){console.log(`\u23F8\uFE0F Fragment ${e.id}: No content to update`);return}this.applyContentUpdate(n,o,e.id),this.onFragmentUpdate&&this.onFragmentUpdate(e,n)}reconstructFromDiffUpdate(e,n){if(!e.length&&(!n.s||!n.s.length))return console.warn("\u26A0\uFE0F No static segments available for reconstruction"),null;let t=n.s||e;if(!Object.keys(n).some(c=>c!=="s"&&c!=="h"&&c!=="S"&&c!=="H"))return t.join("");let o="";for(let c=0;c<t.length;c++)if(o+=t[c],c<t.length-1){let p=n[c.toString()];p!==void 0&&(o+=p)}return o}applyContentUpdate(e,n,t){if(t==="2"){let o=e.getAttribute("style")||"no style";console.log(`\u{1F3A8} Fragment ${t} BEFORE update: style="${o}"`),console.log(`\u{1F3A8} Fragment ${t} BEFORE update: innerHTML="${e.innerHTML}"`)}let i=e.cloneNode(!1);if(i.innerHTML=n,console.log(`\u{1F504} Updating fragment ${t}:`,{element:e.tagName+(e.className?"."+e.className:"")+(e.getAttribute("lvt-id")?`[lvt-id="${e.getAttribute("lvt-id")}"]`:""),oldContent:e.innerHTML.substring(0,100)+(e.innerHTML.length>100?"...":""),newContent:n.substring(0,100)+(n.length>100?"...":"")}),ee(e,i,{onBeforeElUpdated:(o,c)=>{if(t==="2"){let p=o.getAttribute("style")||"no style",T=c.getAttribute("style")||"no style";console.log(`\u{1F527} Fragment ${t} morphdom: "${p}" \u2192 "${T}"`)}return o===document.activeElement,!0},childrenOnly:!1}),t==="2"){let o=e.getAttribute("style")||"no style";console.log(`\u{1F3A8} Fragment ${t} AFTER update: style="${o}"`),console.log(`\u{1F3A8} Fragment ${t} AFTER update: innerHTML="${e.innerHTML}"`),setTimeout(()=>{let c=document.querySelector('[lvt-id="2"]');if(c){let p=c.getAttribute("style")||"no style";console.log(`\u{1F50D} Fragment ${t} VERIFICATION (10ms later): style="${p}"`)}},10)}console.log(`\u2705 Fragment ${t}: Applied diff update`)}sendAction(e,n={}){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("\u26A0\uFE0F WebSocket not connected, cannot send action");return}let t=Array.from(this.staticCache.keys()),i={action:e,cache:t,...n};console.log("\u{1F4E4} Sending action:",i),console.log(`\u{1F4E6} Cache info: ${t.length} cached fragments: [${t.join(", ")}]`),this.ws.send(JSON.stringify(i))}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error(`\u274C Max reconnection attempts (${this.maxReconnectAttempts}) reached`);return}this.reconnectAttempts++;let e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`\u{1F504} Reconnection attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${e}ms`),setTimeout(()=>{this.pageToken&&this.connect(this.pageToken)},e)}disconnect(){this.ws&&(this.ws.close(1e3,"Client requested disconnect"),this.ws=null),this.staticCache.clear()}};function we(){if(typeof window>"u"||typeof document>"u")return;function a(){let e=document.querySelector('meta[name="livetemplate-token"]');if(!e){console.warn('\u26A0\uFE0F LiveTemplate: No token found. Add <meta name="livetemplate-token" content="{{.Token}}"> to your template.');return}let n=e.getAttribute("content");if(!n){console.warn("\u26A0\uFE0F LiveTemplate: Empty token found.");return}let t=new U({onOpen:()=>console.log("\u{1F50C} Connected to LiveTemplate"),onError:i=>console.error("\u274C LiveTemplate error:",i)});window.liveTemplateClient=t,t.connect(n),document.addEventListener("click",function(i){let o=i.target.getAttribute("data-lvt-action");o&&(i.preventDefault(),t.sendAction(o))}),console.log("\u2705 LiveTemplate auto-initialized")}u(a,"initLiveTemplate"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a()}u(we,"autoInit");typeof window<"u"&&(window.LiveTemplateClient=U,we());var Ue=U;})();
