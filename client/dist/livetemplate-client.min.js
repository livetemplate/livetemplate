(()=>{var ce=Object.defineProperty;var f=(i,e)=>ce(i,"name",{value:e,configurable:!0});var X=11;function oe(i,e){var t=e.attributes,a,n,o,c,u;if(!(e.nodeType===X||i.nodeType===X)){for(var y=t.length-1;y>=0;y--)a=t[y],n=a.name,o=a.namespaceURI,c=a.value,o?(n=a.localName||n,u=i.getAttributeNS(o,n),u!==c&&(a.prefix==="xmlns"&&(n=a.name),i.setAttributeNS(o,n,c))):(u=i.getAttribute(n),u!==c&&i.setAttribute(n,c));for(var d=i.attributes,p=d.length-1;p>=0;p--)a=d[p],n=a.name,o=a.namespaceURI,o?(n=a.localName||n,e.hasAttributeNS(o,n)||i.removeAttributeNS(o,n)):e.hasAttribute(n)||i.removeAttribute(n)}}f(oe,"morphAttrs");var $,le="http://www.w3.org/1999/xhtml",A=typeof document>"u"?void 0:document,de=!!A&&"content"in A.createElement("template"),he=!!A&&A.createRange&&"createContextualFragment"in A.createRange();function fe(i){var e=A.createElement("template");return e.innerHTML=i,e.content.childNodes[0]}f(fe,"createFragmentFromTemplate");function ue(i){$||($=A.createRange(),$.selectNode(A.body));var e=$.createContextualFragment(i);return e.childNodes[0]}f(ue,"createFragmentFromRange");function ve(i){var e=A.createElement("body");return e.innerHTML=i,e.childNodes[0]}f(ve,"createFragmentFromWrap");function pe(i){return i=i.trim(),de?fe(i):he?ue(i):ve(i)}f(pe,"toElement");function I(i,e){var t=i.nodeName,a=e.nodeName,n,o;return t===a?!0:(n=t.charCodeAt(0),o=a.charCodeAt(0),n<=90&&o>=97?t===a.toUpperCase():o<=90&&n>=97?a===t.toUpperCase():!1)}f(I,"compareNodeNames");function me(i,e){return!e||e===le?A.createElement(i):A.createElementNS(e,i)}f(me,"createElementNS");function ye(i,e){for(var t=i.firstChild;t;){var a=t.nextSibling;e.appendChild(t),t=a}return e}f(ye,"moveChildren");function q(i,e,t){i[t]!==e[t]&&(i[t]=e[t],i[t]?i.setAttribute(t,""):i.removeAttribute(t))}f(q,"syncBooleanAttrProp");var Q={OPTION:function(i,e){var t=i.parentNode;if(t){var a=t.nodeName.toUpperCase();a==="OPTGROUP"&&(t=t.parentNode,a=t&&t.nodeName.toUpperCase()),a==="SELECT"&&!t.hasAttribute("multiple")&&(i.hasAttribute("selected")&&!e.selected&&(i.setAttribute("selected","selected"),i.removeAttribute("selected")),t.selectedIndex=-1)}q(i,e,"selected")},INPUT:function(i,e){q(i,e,"checked"),q(i,e,"disabled"),i.value!==e.value&&(i.value=e.value),e.hasAttribute("value")||i.removeAttribute("value")},TEXTAREA:function(i,e){var t=e.value;i.value!==t&&(i.value=t);var a=i.firstChild;if(a){var n=a.nodeValue;if(n==t||!t&&n==i.placeholder)return;a.nodeValue=t}},SELECT:function(i,e){if(!e.hasAttribute("multiple")){for(var t=-1,a=0,n=i.firstChild,o,c;n;)if(c=n.nodeName&&n.nodeName.toUpperCase(),c==="OPTGROUP")o=n,n=o.firstChild,n||(n=o.nextSibling,o=null);else{if(c==="OPTION"){if(n.hasAttribute("selected")){t=a;break}a++}n=n.nextSibling,!n&&o&&(n=o.nextSibling,o=null)}i.selectedIndex=t}}},U=1,Y=11,Z=3,ee=8;function T(){}f(T,"noop");function Ae(i){if(i)return i.getAttribute&&i.getAttribute("id")||i.id}f(Ae,"defaultGetNodeKey");function ge(i){return f(function(t,a,n){if(n||(n={}),typeof a=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var o=a;a=A.createElement("html"),a.innerHTML=o}else a=pe(a);else a.nodeType===Y&&(a=a.firstElementChild);var c=n.getNodeKey||Ae,u=n.onBeforeNodeAdded||T,y=n.onNodeAdded||T,d=n.onBeforeElUpdated||T,p=n.onElUpdated||T,C=n.onBeforeNodeDiscarded||T,b=n.onNodeDiscarded||T,ae=n.onBeforeElChildrenUpdated||T,ne=n.skipFromChildren||T,G=n.addChild||function(r,s){return r.appendChild(s)},H=n.childrenOnly===!0,O=Object.create(null),x=[];function k(r){x.push(r)}f(k,"addKeyedRemoval");function K(r,s){if(r.nodeType===U)for(var v=r.firstChild;v;){var l=void 0;s&&(l=c(v))?k(l):(b(v),v.firstChild&&K(v,s)),v=v.nextSibling}}f(K,"walkDiscardedChildNodes");function M(r,s,v){C(r)!==!1&&(s&&s.removeChild(r),b(r),K(r,v))}f(M,"removeNode");function B(r){if(r.nodeType===U||r.nodeType===Y)for(var s=r.firstChild;s;){var v=c(s);v&&(O[v]=s),B(s),s=s.nextSibling}}f(B,"indexTree"),B(t);function V(r){y(r);for(var s=r.firstChild;s;){var v=s.nextSibling,l=c(s);if(l){var h=O[l];h&&I(s,h)?(s.parentNode.replaceChild(h,s),L(h,s)):V(s)}else V(s);s=v}}f(V,"handleNodeAdded");function ie(r,s,v){for(;s;){var l=s.nextSibling;(v=c(s))?k(v):M(s,r,!0),s=l}}f(ie,"cleanupFromEl");function L(r,s,v){var l=c(s);if(l&&delete O[l],!v){var h=d(r,s);if(h===!1||(h instanceof HTMLElement&&(r=h,B(r)),i(r,s),p(r),ae(r,s)===!1))return}r.nodeName!=="TEXTAREA"?re(r,s):Q.TEXTAREA(r,s)}f(L,"morphEl");function re(r,s){var v=ne(r,s),l=s.firstChild,h=r.firstChild,N,g,E,P,w;e:for(;l;){for(P=l.nextSibling,N=c(l);!v&&h;){if(E=h.nextSibling,l.isSameNode&&l.isSameNode(h)){l=P,h=E;continue e}g=c(h);var F=h.nodeType,S=void 0;if(F===l.nodeType&&(F===U?(N?N!==g&&((w=O[N])?E===w?S=!1:(r.insertBefore(w,h),g?k(g):M(h,r,!0),h=w,g=c(h)):S=!1):g&&(S=!1),S=S!==!1&&I(h,l),S&&L(h,l)):(F===Z||F==ee)&&(S=!0,h.nodeValue!==l.nodeValue&&(h.nodeValue=l.nodeValue))),S){l=P,h=E;continue e}g?k(g):M(h,r,!0),h=E}if(N&&(w=O[N])&&I(w,l))v||G(r,w),L(w,l);else{var W=u(l);W!==!1&&(W&&(l=W),l.actualize&&(l=l.actualize(r.ownerDocument||A)),G(r,l),V(l))}l=P,h=E}ie(r,h,g);var z=Q[r.nodeName];z&&z(r,s)}f(re,"morphChildren");var m=t,R=m.nodeType,J=a.nodeType;if(!H){if(R===U)J===U?I(t,a)||(b(t),m=ye(t,me(a.nodeName,a.namespaceURI))):m=a;else if(R===Z||R===ee){if(J===R)return m.nodeValue!==a.nodeValue&&(m.nodeValue=a.nodeValue),m;m=a}}if(m===a)b(t);else{if(a.isSameNode&&a.isSameNode(m))return;if(L(m,a,H),x)for(var _=0,se=x.length;_<se;_++){var j=O[x[_]];j&&M(j,j.parentNode,!1)}}return!H&&m!==t&&t.parentNode&&(m.actualize&&(m=m.actualize(t.ownerDocument||A)),t.parentNode.replaceChild(m,t)),m},"morphdom")}f(ge,"morphdomFactory");var we=ge(oe),te=we;var D=class{static{f(this,"LiveTemplateClient")}constructor(e={}){this.wsUrl=e.wsUrl||this.buildWebSocketUrl(),this.pageToken=null,this.ws=null,this.staticCache=new Map,this.hashCache=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=e.maxReconnectAttempts||5,this.reconnectDelay=e.reconnectDelay||1e3,this.loadPersistentCache(),this.onOpen=e.onOpen||(()=>{}),this.onClose=e.onClose||(()=>{}),this.onError=e.onError||(t=>console.error("LiveTemplate error:",t)),this.onFragmentUpdate=e.onFragmentUpdate||null}loadPersistentCache(){try{let e=localStorage.getItem("livetemplate-cache");if(e){let t=JSON.parse(e);t.statics&&Object.entries(t.statics).forEach(([a,n])=>{this.staticCache.set(a,n)}),t.hashes&&Object.entries(t.hashes).forEach(([a,n])=>{this.hashCache.set(a,n)}),console.log(`Loaded ${this.staticCache.size} cached fragments from localStorage`)}}catch(e){console.warn("Failed to load cache from localStorage:",e),localStorage.removeItem("livetemplate-cache")}}savePersistentCache(){try{let e={statics:Object.fromEntries(this.staticCache),hashes:Object.fromEntries(this.hashCache),timestamp:Date.now()};localStorage.setItem("livetemplate-cache",JSON.stringify(e))}catch(e){if(console.warn("Failed to save cache to localStorage:",e),e.name==="QuotaExceededError"){localStorage.removeItem("livetemplate-cache");try{localStorage.setItem("livetemplate-cache",JSON.stringify(cacheData))}catch(t){console.error("Failed to save cache even after clearing:",t)}}}}buildWebSocketUrl(){let e=window.location.protocol==="https:"?"wss:":"ws:",t=window.location.host;return`${e}//${t}/ws`}connect(e){if(this.ws&&this.ws.readyState===WebSocket.OPEN)return;this.pageToken=e;let t=`${this.wsUrl}?token=${e}`;this.ws=new WebSocket(t),this.setupEventHandlers()}setupEventHandlers(){this.ws.onopen=()=>{this.reconnectAttempts=0,this.onOpen()},this.ws.onclose=e=>{this.onClose(e),e.code!==1e3&&this.attemptReconnect()},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.onError(e)},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.applyFragments(t)}catch(t){console.error("Error parsing fragment data:",t)}}}applyFragments(e){(Array.isArray(e)?e:Object.entries(e).map(([a,n])=>({id:a,data:n}))).forEach(a=>{try{this.applyDiffUpdate(a)}catch(n){console.error(`Error applying fragment ${a.id}:`,n)}})}applyDiffUpdate(e){let t=document.querySelector(`[data-lvt-id="${e.id}"]`);if(t||(/^\d/.test(e.id)?t=document.querySelector(`[id="${e.id}"]`):t=document.querySelector(`#${e.id}`)),!t){console.warn(`Element with data-lvt-id="${e.id}" or id="${e.id}" not found`);return}if(!e.data||typeof e.data!="object"){console.warn(`Invalid diff.Update data for fragment ${e.id}`);return}let a=e.data,n=this.hashCache.get(e.id),o=a.h;o&&n&&o!==n&&(console.log(`Cache invalidated for fragment ${e.id}: hash ${n} \u2192 ${o}`),this.staticCache.delete(e.id),this.hashCache.delete(e.id)),a.s&&Array.isArray(a.s)&&(this.staticCache.set(e.id,a.s),o&&this.hashCache.set(e.id,o),this.savePersistentCache());let c=this.staticCache.get(e.id)||[],u=this.reconstructFromDiffUpdate(c,a);if(u!==null){if(t.tagName==="INPUT"&&(t.type==="text"||t.type==="email"||t.type==="password"||!t.type)){let y=document.createElement("div");y.innerHTML=u;let d=y.querySelector("input");if(d){let p=d.getAttribute("value")||"";t.value=p,t.setAttribute("value",p)}}else this.applyContentUpdate(t,u,e.id);this.onFragmentUpdate&&this.onFragmentUpdate(e,t)}}reconstructFromDiffUpdate(e,t){if(!e.length&&(!t.s||!t.s.length))return console.warn("No static segments available for reconstruction"),null;let a=t.s||e;if(!Object.keys(t).some(c=>c!=="s"&&c!=="h"&&c!=="S"&&c!=="H"))return a.join("");let o="";for(let c=0;c<a.length;c++)if(o+=a[c],c<a.length-1){let u=t[c.toString()];u!==void 0&&(o+=u)}return o}applyContentUpdate(e,t,a){if(["META","LINK","INPUT","IMG","BR","HR","AREA","BASE","COL","EMBED","SOURCE","TRACK","WBR"].includes(e.tagName)){let d=t.match(/<[^>]+>/);if(d){let p=document.createElement("div");p.innerHTML=d[0];let C=p.firstChild;C&&Array.from(C.attributes).forEach(b=>{e.setAttribute(b.name,b.value)})}return}let c=new DOMParser().parseFromString(t,"text/html"),u=c.body.firstChild;if(u||(u=c.head.firstChild),!u){console.error(`Failed to parse content for fragment ${a}:`,t);return}te(e,u,{onBeforeElUpdated:d=>(d===document.activeElement,!0),childrenOnly:!1}),e.querySelectorAll('input[type="text"], input[type="email"], input[type="password"], input:not([type])').forEach(d=>{let p=d.getAttribute("value")||"";d.value!==p&&(d.value=p)})}sendAction(e,t={}){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("WebSocket not connected, cannot send action");return}let a={action:e,token:this.pageToken||"",data:t};console.log(`Sending action "${e}" with token`),this.ws.send(JSON.stringify(a))}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error(`Max reconnection attempts (${this.maxReconnectAttempts}) reached`);return}this.reconnectAttempts++;let e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{this.pageToken&&this.connect(this.pageToken)},e)}disconnect(){this.ws&&(this.ws.close(1e3,"Client requested disconnect"),this.ws=null),this.staticCache.clear()}};function Se(){if(typeof window>"u"||typeof document>"u")return;function i(){let e=document.querySelector('meta[name="livetemplate-token"]');if(!e){console.warn('LiveTemplate: No token found. Add <meta name="livetemplate-token" content="{{.Token}}"> to your template.');return}let t=e.getAttribute("content");if(!t){console.warn("LiveTemplate: Empty token found.");return}let a=new D({onOpen:()=>{},onError:n=>console.error("LiveTemplate error:",n)});window.liveTemplateClient=a,a.connect(t),document.addEventListener("click",function(n){let o=n.target.getAttribute("data-lvt-action");if(o){n.preventDefault();let c={},u=n.target.getAttribute("data-lvt-params");if(u)try{let d=JSON.parse(u);c={...c,...d}}catch(d){console.warn(`Failed to parse data-lvt-params: ${u}`,d)}let y=n.target.getAttribute("data-lvt-element");if(y){let d=document.getElementById(y);if(d){let p="";d.type==="checkbox"||d.type==="radio"?p=d.checked:d.value!==void 0?p=d.value:p=d.textContent||d.innerText||"";let C=d.name||y;c[C]=p}else console.warn(`Element with id "${y}" not found`)}a.sendAction(o,c)}})}f(i,"initLiveTemplate"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()}f(Se,"autoInit");typeof window<"u"&&(window.LiveTemplateClient=D,Se());var Ne=D;})();
